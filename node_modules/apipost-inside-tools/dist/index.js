"use strict";var e=require("apipost-tools"),t=require("lodash"),n=require("uuid");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=r(e),a=["类型","Array","Boolean","Date","Function","NaN","Number","Integer","Object","RegExp","String","Undefined","File"],o=function(e){var n="Any",r={Array:t.isArray,Boolean:t.isBoolean,Date:t.isDate,Function:t.isFunction,NaN:isNaN,Number:t.isNumber,Integer:t.isInteger,Object:t.isObject,RegExp:t.isRegExp,String:t.isString,Undefined:t.isUndefined,Null:t.isNull};return a.forEach((function(t){r.hasOwnProperty(t)&&r[t](e)&&(n=t)})),n},s={none:"none","multipart/form-data":"form-data","application/x-www-form-urlencoded":"urlencoded","application/json":"json","application/xml":"xml","application/javascript":"javascript","text/plain":"plain","text/html":"html"},l={import2array:function(e,n){void 0===n&&(n="");var r,s=[];if(i.default.isJson(e))if((r=JSON.parse(e))instanceof Array)for(var l=0,c=r;l<c.length;l++){var u=c[l];if(u.hasOwnProperty("key")&&u.key&&"undefined"!=u.key){v=(null==u?void 0:u.value)||"";t.isObject(v)&&(v=JSON.stringify(v)),s.push({description:(null==u?void 0:u.description)||"",is_checked:u.hasOwnProperty("is_checked")&&0==u.is_checked?0:1,key:(null==u?void 0:u.key)||"",type:u.hasOwnProperty("type")&&"File"==u.type?"File":"Text",not_null:u.hasOwnProperty("not_null")&&-1==u.not_null?-1:1,field_type:(null==u?void 0:u.field_type)&&a.includes(u.field_type)?u.field_type:o(v)||"Text",value:"query"==n?encodeURIComponent(String(v)||""):String(v)||""})}}else for(var p in r){v=r[p]||"";t.isObject(v)&&(v=JSON.stringify(v)),p&&""!=p&&s.push({description:"",is_checked:1,key:String(p),type:"Text",not_null:1,field_type:o(v)||"Text",value:"query"==n?encodeURIComponent(String(v)):String(v)})}else for(var d in r=e.split(/((\r\n)|[\r\n])+/gi))if("string"==typeof r[d]&&r[d].length>0){var y=r[d].indexOf(":"),f=r[d].split(":"),p="".concat(f[0]).trim(),v="".concat(r[d].substr(y+1)).trim();i.default.isJson(v)&&(v=JSON.stringify(v)),p&&p.length>0&&s.push({description:"",is_checked:1,key:p,type:"Text",not_null:1,field_type:o(v)||"Text",value:"query"==n?encodeURIComponent(v):v})}return s},export2str:function(e,t){void 0===t&&(t="key-value");try{var n=[],r={},i="";if(e instanceof Array)switch(t){case"json":e.forEach((function(e){e.hasOwnProperty("key")&&e.key&&(r[String(e.key)]=String((null==e?void 0:e.value)||""))})),i=JSON.stringify(r,null,"\t");break;case"json-desc":n=e.filter((function(e){return e.hasOwnProperty("key")&&e.key})),i=JSON.stringify(n,null,"\t");break;case"key-value":e.forEach((function(e){e.hasOwnProperty("key")&&e.key&&(i+="".concat(e.key,":").concat((null==e?void 0:e.value)||"","\n"))}))}return i}catch(e){return""}},importdesc2array:function(e,n){var r,a=[];if(i.default.isJson(e))if((r=JSON.parse(e))instanceof Array);else for(var o in r){u=r[o]||"";t.isObject(u)&&(u=JSON.stringify(u)),o&&""!=o&&a.push({description:String(u),key:o})}else for(var s in r=e.split(/((\r\n)|[\r\n])+/gi))if("string"==typeof r[s]&&r[s].length>0){var l=r[s].indexOf(":"),c=r[s].split(":"),o="".concat(c[0]).trim(),u="".concat(r[s].substr(l+1)).trim();i.default.isJson(u)&&(u=JSON.stringify(u)),o&&o.length>0&&a.push({key:o,description:u})}return a},exportdesc2str:function(e,t){void 0===t&&(t="key-value");try{var n={},r="";if(e instanceof Array)switch(t){case"json":e.forEach((function(e){e.hasOwnProperty("key")&&e.key&&(n[String(e.key)]=String((null==e?void 0:e.description)||""))})),r=JSON.stringify(n,null,"\t");break;case"key-value":e.forEach((function(e){e.hasOwnProperty("key")&&e.key&&(r+="".concat(e.key,":").concat((null==e?void 0:e.description)||"","\n"))}))}return r}catch(e){return""}},objectArr2uniqueArr:function(e){var t=[],n={};if(e instanceof Array)for(var r=0;r<e.length;r++){var i=Object.keys(e[r]);i.sort((function(e,t){return Number(e)-Number(t)}));for(var a="",o=0;o<i.length;o++)a+=JSON.stringify(i[o]),a+=JSON.stringify(e[r][i[o]]);n.hasOwnProperty(a)||(t.push(e[r]),n[a]=!0)}return t},har2apipost:function(e){var t;try{var r={name:"新建接口",request:{auth:{type:"noauth",kv:{key:"",value:""},bearer:{key:""},basic:{username:"",password:""}},body:{mode:"none",parameter:[],raw:"",raw_para:[]},cookie:{parameter:[]},description:(null==e?void 0:e.comment)||"",event:{pre_script:"",test:""},header:{parameter:[]},query:{parameter:[]},resful:{parameter:[]},url:(null==e?void 0:e.url)||""},update_day:parseInt(String(new Date((new Date).toLocaleDateString()).getTime()/1e3),10),update_dtime:Date.parse(String(new Date))/1e3,create_dtime:Date.parse(String(new Date))/1e3,is_changed:-1,mark:"developing",method:(null==e?void 0:e.method)||"GET",parent_id:"0",project_id:"-1",sort:-1,target_id:n.v4(),type_sort:"1",version:1,target_type:"api",response:{success:{parameter:[],raw:""},error:{parameter:[],raw:""}},mock:"{}",mock_url:"",url:(null==e?void 0:e.url)||""},i=r.request;if(e.hasOwnProperty("headers")&&e.headers instanceof Array)for(var a=0,o=e.headers;a<o.length;a++){var l=o[a];(null==l?void 0:l.name)&&i.header.parameter.push({is_checked:"1",type:"Text",key:(null==l?void 0:l.name)||"",value:(null==l?void 0:l.value)||"",not_null:"1",description:(null==l?void 0:l.comment)||"",field_type:"Text"})}if(e.hasOwnProperty("queryString")&&e.queryString instanceof Array)for(var c=0,u=e.queryString;c<u.length;c++){var p=u[c];(null==p?void 0:p.name)&&i.query.parameter.push({is_checked:"1",type:"Text",key:(null==p?void 0:p.name)||"",value:(null==p?void 0:p.value)||"",not_null:"1",description:(null==p?void 0:p.comment)||"",field_type:"Text"})}if(e.hasOwnProperty("postData")&&e.postData instanceof Object&&e.postData.hasOwnProperty("mimeType")){var d=s[e.postData.mimeType]||"none";if(i.body.mode=d,i.body.raw=(null===(t=e.postData)||void 0===t?void 0:t.text)||"",e.postData.hasOwnProperty("params")&&e.postData.params instanceof Array)for(var y=0,f=e.postData.params;y<f.length;y++){var v=f[y];(null==v?void 0:v.name)&&i.body.parameter.push({is_checked:"1",type:v.hasOwnProperty("fileName")?"File":"Text",key:(null==v?void 0:v.name)||(null==v?void 0:v.fileName)||"",value:(null==v?void 0:v.value)||(null==v?void 0:v.fileName)||"",not_null:"1",description:(null==v?void 0:v.comment)||"",field_type:"Text"})}}return r}catch(e){return!1}},isElectron:function(){return!!(window&&window.process&&window.process.versions&&window.process.versions.electron)},setCookie:function(e,t,n,r){var i=new Date,a="";r?(i.setDate(i.getDate()+r),a=i.toUTCString()):a="",document.cookie="".concat(e,"=").concat(escape(t),";Path=/;").concat(n&&"Domain=.".concat(n)).concat(a&&";expiredays=".concat(a))},getCookie:function(e){for(var t=encodeURIComponent(e),n="(^| )".concat(t,"=([^;]*)(;|$)"),r=new RegExp(n),i="",a=document.cookie.split("; "),o=0;o<a.length;o++){var s=a[o].split("=");if(s[0]==e&&s[1].length>0)return s[1]}if(document&&document.hasOwnProperty("cookie")){var l=document.cookie.match(r);l&&(null==l?void 0:l.length)>2&&(i=l[2])}return i},ConvertResult:function(e,t,n){return{status:e,message:t,data:n}},getCachePath:function(){var e=process.env.TMPDIR;return e||(e=process.env.LOCALAPPDATA),e||(e=process.env.HOME),e||(e=process.env.PWD),e},isXml:function(e){return"html"!==(new DOMParser).parseFromString(e,"text/xml").documentElement.nodeName&&"<"===e.substring(0,1)&&">"===e.charAt(e.length-1)}};module.exports=l;
