"use strict";var e=require("lodash"),r=require("uuid"),n=require("@apidevtools/json-schema-ref-parser"),t=require("mockjs"),i={};new Array("phone","mobile").forEach((function(e){i[e]=function(){return this.pick(["131","132","137","188"])+t.mock(/\d{8}/)}})),new Array("avatar","icon","img","photo","pic").forEach((function(e){i[e]=function(){return t.mock("@image('400x400')")}})),new Array("description").forEach((function(e){i[e]=function(){return t.mock("@cparagraph")}})),new Array("id").forEach((function(e){i[e]=function(){return r.v4()}})),t.Random.extend(i),module.exports=function(){function i(e){return t.mock(String(e))}function a(n){if(e.isArray(n.oneOf))return a(n.oneOf[e.random(0,n.oneOf.length-1)]);if(e.isArray(n.anyOf))return a(n.anyOf[e.random(0,n.anyOf.length-1)]);if(!e.isUndefined(n.default))return n.default;if(!e.isUndefined(n.example))return n.example;if(e.isArray(n.enum))return n.enum[e.random(0,n.enum.length-1)];switch(e.isArray(n)?e.first(n.type):n.type){case"null":return null;case"boolean":return!e.random(0,1);case"object":return n.hasOwnProperty("properties")&&0!=Object.keys(n.properties).length?e.mapValues(n.properties,a):{};case"array":if(!n.items)return[];var t=[],o=n.items;for(e.isArray(o.anyOf)&&t.push(a(o.anyOf[e.random(0,o.anyOf.length-1)])),e.isArray(o.oneOf)&&t.push(a(o.oneOf[e.random(0,o.oneOf.length-1)]));t.length<(n.minItems||1);)t.push(a(o));return n.maxItems?e.take(t,n.maxItems):t;case"string":if(e.isArray(n.enum))return n.enum[e.random(0,n.enum.length-1)];var u=n.default,c=e.isNil(n.minLength)?0:n.minLength,m=e.isNil(n.maxLength)?u.length:n.maxLength;if(e.isString(n.format)){var s={email:i("@email()"),hostname:"apipost.cn",ipv4:i("@ip()"),ipv6:"2400:da00::dbf:0:100",uri:"https://echo.apipost.cn/get.php","uri-reference":"/path#anchor","uri-template":"/path/{param}","json-pointer":"/foo/bar","date-time":new Date("1970-01-01").toJSON(),uuid:r.v4(),_default:i("@ctitle(".concat(c,", ").concat(m,")"))};return(u=s[n.format]||s._default)===s._default&&u.length<c?e.padEnd(u,c,u):u.substr(0,e.clamp(u.length,c,m))}if(!u){if(e.isString(n.mockField)){var f=i(n.mockField);return f!=n.mockField&&e.isString(f)?f:i("@ctitle(".concat(c,", ").concat(m,")"))}return i("@ctitle(".concat(c,", ").concat(m,")"))}break;case"number":case"integer":var l=n.minimum&&n.exclusiveMinimum?n.minimum+1:n.minimum,p=n.maximum&&n.exclusiveMaximum?n.maximum-1:n.maximum,h=e.isNil(l)?Number.MIN_SAFE_INTEGER:l,d=e.isNil(p)?Number.MAX_SAFE_INTEGER:p;if(n.multipleOf&&(h=Math.ceil(h/n.multipleOf)*n.multipleOf,d=Math.floor(d/n.multipleOf)*n.multipleOf),!e.isArray(n.enum))return i("@integer(".concat(h,", ").concat(d,")"));n.enum.forEach((function(r){if(e.inRange(r,h,d))return r}));break;default:return{}}return n}function o(r){return r.allOf&&r.allOf[0]&&(r=e.reduce(r.allOf,(function(r,n){return e.merge({},r,o(n))}),r)),r}Object.defineProperty(this,"mock",{value:function(r){return r=e.cloneDeep(r),new Promise((function(t,i){r=o(r),n.dereference(r,(function(r,n){if(r)i({});else try{!function r(n){if(e.isObject(n.properties))for(var t in n.properties)e.isObject(n.properties[t].mock)&&e.isString(n.properties[t].mock.mock)?n.properties[t].mockField=n.properties[t].mock.mock:n.properties[t].mockField="@".concat(t),n.properties&&e.isObject(n.properties[t])&&r(n.properties[t]);else"array"===n.type&&e.isObject(n.items)&&r(n.items)}(n),t(a(n))}catch(e){i({})}}))}))}}),Object.defineProperty(this,"intelligentMockJs",{value:i})};
